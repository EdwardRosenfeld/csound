<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
  <meta name="generator" content=
  "HTML Tidy for Windows (vers 25 March 2009), see www.w3.org">

  <title>Csound Editor for NW.js</title>
  <script src="zepto.min.js" type="text/javascript">
</script>
  <script src="editor.js" type="text/javascript">
</script>
  <script src="cm/lib/codemirror.js" type="text/javascript">
</script>
  <script src="cm/mode/css/css.js" type="text/javascript">
</script>
  <script src="cm/mode/xml/xml.js" type="text/javascript">
</script>
  <script src="cm/mode/javascript/javascript.js" type=
  "text/javascript">
</script>
  <script src="cm/mode/htmlmixed/htmlmixed.js" type=
  "text/javascript">
</script>
  <link rel="stylesheet" href="style.css" type="text/css">
  <link rel="stylesheet" href="cm/lib/codemirror.css" type=
  "text/css">
  <link rel="stylesheet" href="cm/theme/lesser-dark.css" type=
  "text/css">
</head>

<body>
  <div class="buttons">
    <button id="new">New</button>
    <button id="open">Open...</button>
    <button id="save">Save...</button>
    <button id="run" onclick="csound_run()">Run</button>
    <button id="stop" onclick="csound_stop()">Stop</button>
  </div>

  <div id="editor"></div>

  <div class="info">
    <label>Filename:</label> <span id="title"></span>
    <label>Mode:</label> <span id="mode"></span>
  </div>

  <form>
    <input style="display:none;" id="openFile" type="file">
    <input style="display:none;" id="saveFile" type="file" nwsaveas="">
    <script type="text/javascript">
    </script>
  </form>
  <base target="_blank" />
  <script type="text/javascript">
    var csound = require('csound');
    var gui = require('nw.gui');
    var csound_window = null;
      function csound_run()
      {
        console.log('csound_run()...');
        console.log('csound:' + csound);
        var filename = document.getElementById('title').innerHTML;
        // Thre are two file modes for csound.node:
        // .html files, which must always create their own csound object with
        // require('csound');, and .csd files, which assume that the csound
        // object has already been created in their JavasScript context.
        console.log('filename:' + filename);
        if (filename.endsWith('html')) {
            csound_window = gui.Window.open('file:///' + filename,
                {
                    "position": 'center',
                    "nodejs": true,
                    "new-instance": true,
                }
            );
            return;
        };
        if (filename.endsWith('.csd')) {
            csound_window = gui.Window.open('about:blank',
                {
                    "position": 'center',
                    "nodejs": true,
                    "new-instance": true,
                    "inject-js-start": 'embed_csound.js',
                }
            );
            csound_window.csound.compileCsd(filename);
            return;
        }
        alert('Unknown file type:' + filename);
      };
      function csound_stop()
      {
        console.log('csound_stop()...');

      }
  </script>
  </body>
  </html>

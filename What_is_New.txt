WHAT NEEDS HEAVY TESTING
========================

Multiple strings in score

--sample-accurate

Arrays


What is New, What has Changed
=============================

Build system in cmake (and not scons as in Csound5).  


Support for old hardware and C compilers has been removed; this
includes Macintosh OS9 and earlier, Watcom, Borland and Symmantec C
compilers. 


Note events can start and end in mid-kcycle.  As this is an
incompatable change it is only invoked with the command-line option
    --sample-accurate
is specified.  Not that this does not work for tied notes, and use of
skipping initialisation has questionable use.


A number of table access opcodes have been rewritten but should behave
the same.  Similarly diskin and diskin2 now use the same code and so
diskin should be more stable


The old parser is totally gone.


New syntax in csound6 includes +=, -=, *= and /= operators


Opcodes like add, sub, mul and div are no longer available in opcode
format, only via + - * /


Functions taninv2 and divz now exist as well as opcodes


Arrays....


Real-time mode....

The new realtime priority mode can be switched on with by passing the
--realtime or setting the CSOUND_PARAMS field realtime_mode to 1.

This has the following effects:
1) all opcode audio file reading/writing is handled asynchronously by
a separate thread
2) all init-pass operations are also performed asynchronously.

Asynchronous file access....

Functions for asynchronous audio file access have been added (see
below)

Analysis formats...

Hetro/adsyn analysis files can be machine byte-order independent if
created with -X.  Down side is a longer file and a little slower
loading.  The het_export utility will create the independent format
from the old, and het_import is no longer necessary.

cvanal will produce machine independent files if -X option is used.
The convolve opcode will accept either format.  You are excouraged to
use the machine independent form.

The number of strings that can be used in a score line is no longer
just one.  It should be open ended now.

New API functions.....

    new configuration/parameter setting functions
    PUBLIC int csoundSetOption(CSOUND *csound, char *option);
    PUBLIC void csoundSetParams(CSOUND *csound, CSOUND_PARAMS *p);
    PUBLIC void csoundGetParams(CSOUND *csound, CSOUND_PARAMS *p);
    PUBLIC void csoundSetOutput(CSOUND *csound, char *name, char *type, char *format);
    PUBLIC void csoundSetInput(CSOUND *csound, char *name);
    PUBLIC void csoundSetMIDIInput(CSOUND *csound, char *name);
    PUBLIC void csoundSetMIDIFileInput(CSOUND *csound, char *name);
    PUBLIC void csoundSetMIDIOutput(CSOUND *csound, char *name);
    PUBLIC void csoundSetMIDIFileOutput(CSOUND *csound, char *name);

    new parsing/compilation functions 
    PUBLIC TREE *csoundParseOrc(CSOUND *csound, char *str);
    PUBLIC int csoundCompileTree(CSOUND *csound, TREE *root);
    PUBLIC int csoundCompileOrc(CSOUND *csound, char *str);
    PUBLIC int csoundReadScore(CSOUND *csound, char *str);
    PUBLIC int csoundCompileArgs(CSOUND *, int argc, char **argv);

    new function for starting csound after first compilation
    PUBLIC int csoundStart(CSOUND *csound);

    new software bus threadsafe getters/setters 
    PUBLIC MYFLT csoundGetControlChannel(CSOUND *csound, const char *name);
    PUBLIC void csoundSetControlChannel(CSOUND *csound, const char *name, MYFLT val);
    PUBLIC void csoundGetAudioChannel(CSOUND *csound, const char *name, MYFLT *samples);
    PUBLIC void csoundSetAudioChannel(CSOUND *csound, const char *name, MYFLT *samples);
    PUBLIC void csoundSetStringChannel(CSOUND *csound, const char *name, char *string);
    PUBLIC  void csoundGetStringChannel(CSOUND *csound, const char  *name, char *string);

    new table threadsafe copy functions
    PUBLIC void csoundTableCopyOut(CSOUND *csound, int table, MYFLT *dest);
    PUBLIC void csoundTableCopyIn(CSOUND *csound, int table, MYFLT *src);
    
    API has been made threadsafe so that performance and control can
    occur in separate threads (after a call to csoundStart() or csoundCompile()).

Invalue/outvalue and channel callbacks and callback setters have been removed.
csoundQueryInterface() has been removed

New internal functions in CSOUND:

    void (*FlushCircularBuffer)(CSOUND *, void *);
     flush circular buffer.
    void *(*FileOpenAsync)(CSOUND *, void *, int, const char *, void *,
                           const char *, int, int, int);
    unsigned int (*ReadAsync)(CSOUND *, void *, MYFLT *, int);
    unsigned int (*WriteAsync)(CSOUND *, void *, MYFLT *, int);
    int  (*FSeekAsync)(CSOUND *, void *, int, int);
      async file access.
    char *(*GetString)(CSOUND *, MYFLT);
       Extract a string originating from a score-event argument.

functions removed
    void *(*FileOpen)(CSOUND *,
                      void*, int, const char*, void*, const char*);

The "private" parts of the API have been changed considerably.  Also
structures like EVTBLK have changed

The LINKAGE1/FLINKAGE1 macros are renamed as LINKAGE_BUILTIN/FLINKAGE_BUILTIN

Template for arate perf-pass opcodes is
------------------------------------------------------------------------
int perf_myopcode(CSOUND *csound, MYOPCODE *p)
{
    uint32_t offset = p->h.insdshead->ksmps_offset;
    uint32_t early  = p->h.insdshead->ksmps_no_end;
    uint32_t nsmps = CS_KSMPS;
    ...
    if (offset) memset(p->res, '\0', offset*sizeof(MYFLT));
    if (early)  {
      nsmps -= early;
      memset(&p->res[nsmps], '\0', early*sizeof(MYFLT));
    }
    for (n=offset; n<nsmps; n++) {
        .....
        p->res[n] = ....
    }
    return OK;
}
------------------------------------------------------------------------



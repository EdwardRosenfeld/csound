<!doctype html>
<html>
  <head>
    <title>Csound Reverb</title>
  </head>

  <body>

  </body>

  <script src='js/CsoundObj.js'></script>

  <script>
let csoundObj;
const TEST_CSD = 
`
<CsoundSynthesizer>
<CsOptions>
</CsOptions>
<CsInstruments>
sr = 44100
ksmps = 32 
nchnls = 2
nchnls_i = 1
0dbfs = 1

instr 1
ain inch 1
al, ar reverbsc ain,ain, 0.6, 5000
  out  al, ar
endin
</CsInstruments>
<CsScore>
i1 0 36000
</CsScore>
</CsoundSynthesizer>
`;

    CsoundObj.importScripts("./js/").then(() => {


      csoundObj = new CsoundObj();

      csoundObj.enableAudioInput((res) => {
      
      if(res) {

        //csoundObj.setOption("-m0");
        csoundObj.compileCSD(TEST_CSD);
        csoundObj.readScore("i1 0 36000");
        csoundObj.setMessageCallback((msg) => document.body.innerText +=  msg + "\n");

        csoundObj.start();

      } else {
        alert("Unable to start microphone.");
      }
      })


    });

  </script>
</html>

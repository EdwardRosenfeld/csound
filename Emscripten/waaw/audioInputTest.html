<!doctype html>
<html>
  <head>
    <title>Csound MIDI</title>
  </head>

  <body>

  </body>

  <script src='js/CsoundObj.js'></script>

  <script>
let csoundObj;
const TEST_CSD = 
`
<CsoundSynthesizer>
<CsOptions>
-o dac -+rtmidi=null -+rtaudio=null -d -+msg_color=0 -M0 -m0 -iadc
</CsOptions>
<CsInstruments>

sr = 48000
ksmps = 32 
nchnls = 2
nchnls_i = 1
0dbfs = 1

instr 1
  ain in

  al, ar reverbsc ain, ain, 4000, 0.8

  outc(al, ar) 
endin

</CsInstruments>
<CsScore>
i1 0 3600
</CsScore>
</CsoundSynthesizer>

`;

    CsoundObj.importScripts("./js/").then(() => {


      csoundObj = new CsoundObj();

      csoundObj.enableAudioInput((res) => {
      
      if(res) {

        csoundObj.setOption("-m0");
        csoundObj.compileCSD(TEST_CSD);
        csoundObj.setMessageCallback((msg) => document.body.innerText +=  msg + "\n");

        csoundObj.start();

      } else {
        alert("Unable to start microphone.");
      }
      })


    });

  </script>
</html>
